<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Earthquake Animation (TimeDimension + JST + Autoplay)</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<!-- TimeDimension -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-timedimension/1.1.0/leaflet.timedimension.control.min.css">

<style>
html,body { margin:0; padding:0; height:100%; }
#map { width:100%; height:100%; }

/* UI å‰é¢åŒ– */
.leaflet-control-container { z-index:9999 !important; }

/* å‡¡ä¾‹ */
#legend {
    position:absolute;
    top:10px;
    right:10px;
    background:white;
    padding:10px;
    border-radius:6px;
    font-size:14px;
    line-height:1.4;
    box-shadow:0 0 6px rgba(0,0,0,0.3);
    z-index:9999;
}
</style>
</head>

<body>
<div id="map"></div>

<div id="legend">
<b>æ·±ã•ï¼ˆDepthï¼‰</b><br>
<span style="color:#ff0000;">â—</span> æµ…ã„ (0â€“70km)<br>
<span style="color:#ffaa00;">â—</span> ä¸­é–“ (70â€“300km)<br>
<span style="color:#0000ff;">â—</span> æ·±ã„ (300km+)
</div>

<!-- Scripts -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-timedimension/1.1.0/leaflet.timedimension.min.js"></script>

<script>
// ======================================================
//       Python ã§åŸ‹ã‚è¾¼ã‚€ GeoJSON ã‚’ã“ã“ã«å…¥ã‚Œã‚‹
// ======================================================
var eqData = __EQ_JSON__;   // â†ã‚ãªãŸã® Python ãŒã“ã‚Œã‚’ç½®ãæ›ãˆã‚‹


// ======================================================
//                Leaflet + TimeDimension map
// ======================================================
var map = L.map('map', {
    center:[20,0],
    zoom:2,
    timeDimension:true,
    timeDimensionControl:true,
    timeDimensionControlOptions:{
        autoPlay:false,      // å¾Œã§æ‰‹å‹•ã‚¹ã‚¿ãƒ¼ãƒˆ
        loopButton:true,
        playerOptions:{
            transitionTime:600,
            loop:true,
            startOver:true
        }
    }
});

// Light base map
L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png")
    .addTo(map);


// ======================================================
//                          Plates
// ======================================================
fetch("https://raw.githubusercontent.com/fraxen/tectonicplates/master/GeoJSON/PB2002_boundaries.json")
  .then(r=>r.json())
  .then(j=>{
     L.geoJSON(j,{ style:{ color:"#ff00ff",weight:2 }}).addTo(map);
  });


// ======================================================
//               TimeDimension layer
// ======================================================
var eqLayer = L.geoJSON(eqData,{
    pointToLayer:function(feat,latlng){
        return L.circleMarker(latlng, feat.properties.style);
    },
    onEachFeature:function(feat,layer){
        var t = new Date(feat.properties.times[0]);
        var jst = new Date(t.getTime() + 9*3600*1000);

        layer.bindPopup(
            "<b>æ™‚åˆ»(JST):</b> "+jst.toLocaleString()+"<br>"+
            "<b>Magnitude:</b> "+feat.properties.mag+"<br>"+
            "<b>Depth:</b> "+feat.properties.depth+" km"
        );
    }
});

var tdLayer = L.timeDimension.layer.geoJson(eqLayer,{
    updateTimeDimension:true,
    duration:"P30D",
    addlastPoint:false
}).addTo(map);


// ======================================================
//                     ğŸš€ é‡è¦ï¼šè‡ªå‹•å†ç”Ÿ
// ======================================================
map.timeDimension.on("availabletimeschanged", function(){
    console.log("Starting animation...");
    setTimeout(()=>{ 
       map.timeDimension.player.start();
    }, 500);
});

</script>
</body>
</html>
lor(d):
